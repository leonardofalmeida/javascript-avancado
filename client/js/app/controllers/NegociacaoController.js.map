{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordenacaoAtual","_listaNegociacoes","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","error","setInterval","importaNegociacoes","coluna","inverteOrdenacao","ordena","a","b","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","erro","importa","apaga","esvazia","console","log","textoParaData","value","parseInt","parseFloat","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from \"../models/ListaNegociacoes\";\nimport { Mensagem } from \"../models/Mensagem\";\nimport { Negociacao } from \"../models/Negociacao\";\n\nimport { NegociacoesView } from \"../views/NegociacoesView\";\nimport { MensagemView } from \"../views/MensagemView\";\n\nimport { NegociacaoService } from \"../services/NegociacaoService\";\n\nimport { DateHelper } from \"../helpers/DateHelper\";\nimport { Bind } from \"../helpers/Bind\";\n\nclass NegociacaoController {\n  constructor() {\n    // querys\n    let $ = document.querySelector.bind(document);\n    this._inputData = $(\"#data\");\n    this._inputQuantidade = $(\"#quantidade\");\n    this._inputValor = $(\"#valor\");\n\n    // ordenação\n    this._ordenacaoAtual = \"\";\n\n    //negociacoes\n    this._listaNegociacoes = new Bind(\n      new ListaNegociacoes(),\n      new NegociacoesView($(\"#negociacoesView\")),\n      \"adiciona\",\n      \"esvazia\",\n      \"ordena\",\n      \"inverteOrdenacao\"\n    );\n\n    // mensagens\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView($(\"#mensagemView\")),\n      \"texto\"\n    );\n\n    this._service = new NegociacaoService();\n\n    this._init();\n  }\n\n  _init() {\n    this._service\n      .lista()\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._listaNegociacoes.adiciona(negociacao)\n        )\n      )\n      .catch(error => {\n        this._mensagem.texto = error;\n      });\n\n    setInterval(() => {\n      this.importaNegociacoes();\n    }, 3000);\n  }\n\n  ordena(coluna) {\n    if (this._ordenacaoAtual == coluna) {\n      this._listaNegociacoes.inverteOrdenacao();\n    } else {\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\n    }\n    this._ordenacaoAtual = coluna;\n  }\n\n  adiciona(event) {\n    event.preventDefault();\n\n    let negociacao = this._criaNegociacao();\n\n    this._service\n      .cadastra(negociacao)\n      .then(mensagem => {\n        this._listaNegociacoes.adiciona(negociacao);\n        this._mensagem.texto = mensagem;\n        this._limpaFormulario();\n      })\n      .catch(erro => (this._mensagem.texto = erro));\n  }\n\n  importaNegociacoes() {\n    this._service\n      .importa(this._listaNegociacoes.negociacoes)\n      .then(negociacoes => {\n        negociacoes.forEach(negociacao => {\n          this._listaNegociacoes.adiciona(negociacao);\n          this._mensagem.texto =\n            \"Negociações do período importadas com sucesso\";\n        });\n      })\n      .catch(error => (this._mensagem.texto = error));\n  }\n\n  apaga() {\n    this._service\n      .apaga()\n      .then()\n      .then(mensagem => {\n        this._mensagem.texto = mensagem;\n        this._listaNegociacoes.esvazia();\n      })\n      .catch(error => console.log(error));\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(\n      DateHelper.textoParaData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value)\n    );\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = \"\";\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0;\n    this._inputData.focus();\n  }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance() {\n  return negociacaoController;\n}\n"]}