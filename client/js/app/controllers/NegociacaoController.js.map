{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordenacaoAtual","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","error","setInterval","importaNegociacoes","coluna","inverteOrdenacao","ordena","a","b","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaFormulario","erro","importa","apaga","esvazia","console","log","Negociacao","DateHelper","textoParaData","value","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from \"../models/ListaNegociacoes\";\nimport { Mensagem } from \"../models/Mensagem\";\nimport { Negociacao } from \"../models/Negociacao\";\n\nimport { NegociacoesView } from \"../views/NegociacoesView\";\nimport { MensagemView } from \"../views/MensagemView\";\n\nimport { NegociacaoService } from \"../services/NegociacaoService\";\n\nimport { DateHelper } from \"../helpers/DateHelper\";\nimport { Bind } from \"../helpers/Bind\";\n\nexport class NegociacaoController {\n  constructor() {\n    // querys\n    let $ = document.querySelector.bind(document);\n    this._inputData = $(\"#data\");\n    this._inputQuantidade = $(\"#quantidade\");\n    this._inputValor = $(\"#valor\");\n\n    // ordenação\n    this._ordenacaoAtual = \"\";\n\n    //negociacoes\n    this._listaNegociacoes = new Bind(\n      new ListaNegociacoes(),\n      new NegociacoesView($(\"#negociacoesView\")),\n      \"adiciona\",\n      \"esvazia\",\n      \"ordena\",\n      \"inverteOrdenacao\"\n    );\n\n    // mensagens\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView($(\"#mensagemView\")),\n      \"texto\"\n    );\n\n    this._service = new NegociacaoService();\n\n    this._init();\n  }\n\n  _init() {\n    this._service\n      .lista()\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._listaNegociacoes.adiciona(negociacao)\n        )\n      )\n      .catch(error => {\n        this._mensagem.texto = error;\n      });\n\n    setInterval(() => {\n      this.importaNegociacoes();\n    }, 3000);\n  }\n\n  ordena(coluna) {\n    if (this._ordenacaoAtual == coluna) {\n      this._listaNegociacoes.inverteOrdenacao();\n    } else {\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\n    }\n    this._ordenacaoAtual = coluna;\n  }\n\n  adiciona(event) {\n    event.preventDefault();\n\n    let negociacao = this._criaNegociacao();\n\n    this._service\n      .cadastra(negociacao)\n      .then(mensagem => {\n        this._listaNegociacoes.adiciona(negociacao);\n        this._mensagem.texto = mensagem;\n        this._limpaFormulario();\n      })\n      .catch(erro => (this._mensagem.texto = erro));\n  }\n\n  importaNegociacoes() {\n    this._service\n      .importa(this._listaNegociacoes.negociacoes)\n      .then(negociacoes => {\n        negociacoes.forEach(negociacao => {\n          this._listaNegociacoes.adiciona(negociacao);\n          this._mensagem.texto =\n            \"Negociações do período importadas com sucesso\";\n        });\n      })\n      .catch(error => (this._mensagem.texto = error));\n  }\n\n  apaga() {\n    this._service\n      .apaga()\n      .then()\n      .then(mensagem => {\n        this._mensagem.texto = mensagem;\n        this._listaNegociacoes.esvazia();\n      })\n      .catch(error => console.log(error));\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(\n      DateHelper.textoParaData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value)\n    );\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = \"\";\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0;\n    this._inputData.focus();\n  }\n}\n"]}